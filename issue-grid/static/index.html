
<!DOCTYPE html>
<html lang="en">
<head>
  <link rel="stylesheet" href="./style.css">
</head>
<body>

<script src="https://redom.js.org/redom.min.js"></script>
<script>

  const { el, router, mount, text, list, setAttr, setStyle, } = redom;

  class Avatar {
    constructor(user) {
      this.el = el('img.user-icon');
      user && this.update(user);
    }

    update(user) {
      setAttr(this.el, { src: user.icon_url });
    }
  }

  class Label {
    constructor(label) {
      this.el = el('span.label');
      label && this.update(label);
    }

    update(label) {
      this.el.textContent = label.name;
      setStyle(this.el, { 'background-color': label.color });
    }
  }

  class Issue {
    constructor(issue) {
      this.labels = list('div.label-list', Label);
      this.creator = new Avatar();
      this.number = el('span.issue-number');
      this.title = el('span.issue-name');

      this.el = el('div.issue', [
        el('h4.issue-h4', [
          this.creator,
          this.number,
          text(' '),
          this.title,
        ]),

        this.labels,
      ]);

      issue && this.update(issue);
    }

    update(issue) {
      this.labels.update(issue.labels);
      this.creator.update(issue.creator);

      this.number.textContent = `#${issue.number}`;
      this.title.textContent = issue.title;

      /*
      this.labels.update(issue.labels);

      this.el = el('div.issue-pane', [
        el('h4.issue-pane-header', [
          new Avatar(issue.creator),
          el(
            'span.issue-pane-number',
            `#${issue.number}`
          ),
          el(
            'span.issue-pane-title',
            `${issue.title}`

          ),
        ]),
        this.labels
      ]);
      */
    }
  }

  class IssueBin {
    constructor() {
      this.el_issues = list('div.issue-bin', Issue);
      this.el = this.el_issues;
    }

    update(bin) {
      this.el_issues.update(bin.issues);
    }
  }

  class IssueGrid {
    constructor() {
      this.el_bins = list('div.issue-grid', IssueBin);
      this.el = el('div.issue-grid-wrapper', this.el_bins);
    }

    update(bins) {
      this.el_bins.update(bins);
    }
  }

  function main() {
    fetch('/api/bin_issues')
      .then(resp => resp.json())
      .then(data => {
        data = data.slice(0, 2);
        let grid = new IssueGrid();
        grid.update(data);
        mount(document.body, grid);

        /*
        console.log(data);
        let issue = data[2].issues[0];
        console.log(issue);

        let demo = new Issue(issue);
        mount(document.body, demo);
        */
      });

    //let demo = new Issue()

    /*
    let app = router('.app', {
      home: text('yes'),
      about: text('no'),
      contact: text('maybe')
    });

    mount(document.body, app);

    app.update('home');
    app.update('about');
    */
  }
  main();

</script>

</body>
</html>